<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üíê Fiori ‚Äî Fiori e Piante di Nino</title>
  <meta name="description" content="Scegli una foto e ordina su WhatsApp. Consegna a Roma." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --pink:#ff2e8f; --pink2:#ff67b2; --pink3:#ffd1e6;
      --bg:#fff7fb; --ink:#1a1220; --muted:#5a4764;

      --shadow: 0 18px 60px rgba(26,18,32,.12);
      --shadow2: 0 10px 30px rgba(26,18,32,.10);
      --stroke: rgba(255,46,143,.18);

      --rxl:28px; --rmd:16px; --max:1180px;
      --ease:cubic-bezier(.2,.9,.2,1);

      /* Brand colors */
      --wa:#25D366;     /* WhatsApp green */
      --je:#ff7a00;     /* JustEat orange */
      --de:#00a7d7;     /* Deliveroo-ish blue */
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family:"Plus Jakarta Sans", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--ink);
      background:
        radial-gradient(1200px 680px at 15% 10%, rgba(255,46,143,.18), transparent 60%),
        radial-gradient(900px 520px at 85% 12%, rgba(255,103,178,.16), transparent 62%),
        radial-gradient(900px 620px at 55% 90%, rgba(255,209,230,.55), transparent 62%),
        linear-gradient(180deg, #fff2f8, var(--bg));
      overflow-x:hidden;
    }
    a{color:inherit;text-decoration:none}
    .container{width:min(var(--max), calc(100% - 28px)); margin-inline:auto}

    /* Header */
    .nav{
      position:sticky; top:0; z-index:100;
      padding:12px 0;
      background:rgba(255,255,255,.82);
      border-bottom:1px solid rgba(255,46,143,.14);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}
    .brand{display:flex; align-items:center; gap:12px; font-weight:900; letter-spacing:-.2px}
    .brandLogo{
      width:46px;height:46px;border-radius:16px;display:grid;place-items:center;
      background:linear-gradient(135deg, rgba(255,46,143,.14), rgba(255,209,230,.70));
      border:1px solid rgba(255,46,143,.14);
      box-shadow:var(--shadow2);
      overflow:hidden;
      flex:0 0 auto;
    }
    .brandLogo img{width:36px;height:36px;object-fit:contain;display:block}
    .brand small{display:block; font-weight:700; color:var(--muted); margin-top:2px}

    /* Buttons (big, boomer-friendly) */
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:14px 16px;
      border-radius:18px;
      border:1px solid rgba(255,46,143,.18);
      background:rgba(255,255,255,.78);
      font-weight:900;
      box-shadow:var(--shadow2);
      transition: transform .2s var(--ease), background .2s var(--ease);
      user-select:none;
      white-space:nowrap;
      min-height: 52px;
    }
    .btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.96)}
    .btn .logo{width:20px;height:20px;object-fit:contain;filter: drop-shadow(0 8px 14px rgba(26,18,32,.14));}

    .btn-home{ background: rgba(255,46,143,.08); border: 1px solid rgba(255,46,143,.22); }
    .btn-pink{
      border:none; color:#fff;
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      box-shadow: 0 18px 54px rgba(255,46,143,.22);
    }

    /* Brand themed buttons */
    .btn-wa{ border:none; color:#fff; background: linear-gradient(135deg, var(--wa), #1fb85a); }
    .btn-je{ border:none; color:#fff; background: linear-gradient(135deg, var(--je), #ff9a2f); }
    .btn-de{ border:none; color:#fff; background: linear-gradient(135deg, var(--de), #58c6e6); }

    /* Page head */
    section{ padding:18px 0 36px; }
    h1{ margin:0; font-size: clamp(26px, 3vw, 38px); letter-spacing:-.8px; }
    .sub{
      margin:10px 0 0;
      color:var(--muted);
      font-weight:800;
      line-height:1.55;
      font-size: 16px;
      max-width: 70ch;
    }
    .ctaBar{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    /* Grid 4 desktop / 2 mobile */
    .grid{
      margin-top: 16px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns: repeat(2, 1fr); }
      .btn{ width: 100%; } /* mobile: bottoni full-width */
    }

    /* Tiles */
    .tile{
      border-radius: var(--rxl);
      overflow:hidden;
      border: 1px solid rgba(255,46,143,.16);
      box-shadow: var(--shadow);
      background:#fff;
      position:relative;
      aspect-ratio: 1 / 1;
      cursor:pointer;
    }
    .skeleton{
      position:absolute; inset:0;
      background:
        radial-gradient(900px 320px at 15% 0%, rgba(255,46,143,.14), transparent 60%),
        linear-gradient(90deg,
          rgba(255,255,255,.55) 0%,
          rgba(255,209,230,.70) 40%,
          rgba(255,255,255,.55) 80%
        );
      background-size: 100% 100%, 320% 100%;
      animation: shimmer 1.15s linear infinite;
    }
    @keyframes shimmer{ 0%{background-position:0 0,0 0} 100%{background-position:0 0,320% 0} }

    .tile img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
      opacity:0;
      transform: scale(1.02);
      transition: opacity .25s var(--ease), transform .35s var(--ease);
    }
    .tile.loaded img{ opacity:1; }
    .tile:hover img{ transform: scale(1.06); }

    .cap{
      position:absolute; left:12px; right:12px; bottom:12px;
      padding:10px 12px;
      border-radius:16px;
      background: rgba(255,255,255,.86);
      border: 1px solid rgba(255,46,143,.14);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow2);
      font-weight:900;
      display:flex; justify-content:space-between; gap:10px; align-items:center;
    }
    .cap span{ color: var(--muted); font-weight:800; }

    /* Pager */
    .pager{
      margin-top: 18px;
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:center;
    }
    .status{ color: var(--muted); font-weight:900; }

    /* Lightbox (super semplice) */
    .lb{ position:fixed; inset:0; display:none; z-index:200; }
    .lb.open{ display:block; }
    .lb .backdrop{ position:absolute; inset:0; background: rgba(20,12,26,.42); backdrop-filter: blur(6px); }
    .lb .panel{
      position:absolute; left:50%; top:50%;
      transform: translate(-50%, -50%);
      width: min(920px, calc(100% - 20px));
      border-radius: var(--rxl);
      overflow:hidden;
      border: 1px solid rgba(255,46,143,.18);
      background: rgba(255,255,255,.94);
      box-shadow: var(--shadow);
    }
    .lb .top{
      padding: 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom: 1px solid rgba(255,46,143,.14);
      background: rgba(255,46,143,.06);
    }
    .lb .title{
      font-weight: 900;
      letter-spacing: -.3px;
    }
    .xbtn{
      width: 44px; height: 44px; border-radius: 16px;
      border: 1px solid rgba(255,46,143,.16);
      background: rgba(255,255,255,.86);
      box-shadow: var(--shadow2);
      cursor:pointer;
      display:grid; place-items:center;
    }

    .lb .content{ padding: 14px; }
    .lb .bigImg{
      width:100%;
      height:auto;
      max-height: 70vh;
      object-fit: contain;
      background: #fff;
      border-radius: 18px;
      border: 1px solid rgba(255,46,143,.14);
      display:block;
    }
    .lb .help{
      margin-top: 12px;
      color: var(--muted);
      font-weight: 800;
      line-height: 1.5;
      font-size: 15px;
    }
    .lb .actions{
      margin-top: 12px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .noteBox{
      margin-top: 10px;
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,46,143,.14);
      background: rgba(255,255,255,.86);
      color: var(--ink);
      font-weight: 800;
      line-height: 1.45;
      font-size: 14px;
      word-break: break-word;
    }

    /* Floating WhatsApp */
    .floatCta{ position:fixed; right:16px; bottom:16px; z-index:120; }
    @media (max-width: 920px){ .floatCta{ left:16px; right:16px; } .floatCta .btn{ width:100%; } }

    footer{
      padding: 22px 0 40px;
      border-top:1px solid rgba(255,46,143,.14);
      background:rgba(255,255,255,.72);
      backdrop-filter: blur(10px);
    }
    footer .foot{display:flex;justify-content:space-between;gap:14px;flex-wrap:wrap;color:var(--muted);font-weight:900}
  </style>
</head>

<body>
  <header class="nav">
    <div class="container">
      <div class="row">
        <a class="brand" href="../#top" aria-label="Torna alla Home">
          <span class="brandLogo">
            <img src="../immagini-home/fiori%20e%20piante%20di%20nino%20logo%20nero.png" alt="Fiori e Piante di Nino" />
          </span>
          <div>
            Fiori e Piante di Nino
            <small>Galleria ¬∑ Fiori</small>
          </div>
        </a>

        <div class="ctaBar">
          <a class="btn btn-home" href="../">‚Üê Torna alla Home</a>
          <a class="btn btn-wa" id="ctaWA" href="#" rel="noopener nofollow">
            <img class="logo" src="../immagini-home/logo-whatsapp.png" alt="">
            Ordina su WhatsApp
          </a>
          <a class="btn btn-je" href="https://www.justeat.it/restaurants-piante-e-fiori-di-nino---piazza-santiago-del-cile/menu" target="_blank" rel="noopener nofollow">
            <img class="logo" src="../immagini-home/logo-justeat.png" alt="">
            JustEat
          </a>
          <a class="btn btn-de" href="https://deliveroo.it/it/menu/roma/roma-flaminio/piante-e-fiori-di-nino-piazza-santiago-del-cile" target="_blank" rel="noopener nofollow">
            <img class="logo" src="../immagini-home/Logo-deliveroo-.jpg" alt="">
            Deliveroo
          </a>
        </div>
      </div>
    </div>
  </header>

  <main>
    <section>
      <div class="container">
        <h1>Scegli una foto üíê</h1>
        <p class="sub">
          Tocca una foto ‚Üí si apre grande ‚Üí premi ‚ÄúOrdina su WhatsApp‚Äù.
          (Il messaggio viene copiato da solo: ti basta incollare e inviare.)
        </p>

        <div class="grid" id="grid" aria-label="Galleria Fiori"></div>

        <div class="pager">
          <button class="btn btn-pink" id="loadMore">Mostra altre foto</button>
          <div class="status" id="status"></div>
        </div>
      </div>
    </section>

    <footer>
      <div class="container">
        <div class="foot">
          <div>üå∏ Fiori e Piante di Nino ‚Äî Roma ¬∑ <a href="tel:+393394324010">+39 339 432 4010</a></div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <a class="btn btn-home" href="../">‚Üê Home</a>
            <a class="btn btn-pink" href="https://fiori-italia.it/" target="_blank" rel="noopener nofollow">üõí Compra online</a>
          </div>
        </div>
      </div>
    </footer>
  </main>

  <div class="floatCta">
    <a class="btn btn-wa" id="fabWA" href="#" rel="noopener nofollow">
      <img class="logo" src="../immagini-home/logo-whatsapp.png" alt="">
      Ordina su WhatsApp
    </a>
  </div>

  <!-- Lightbox -->
  <div class="lb" id="lb" aria-hidden="true">
    <div class="backdrop" id="lbBackdrop"></div>
    <div class="panel" role="dialog" aria-label="Anteprima foto">
      <div class="top">
        <div class="title" id="lbTitle">Foto</div>
        <button class="xbtn" id="lbClose" aria-label="Chiudi">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <div class="content">
        <img class="bigImg" id="lbImg" alt="Foto selezionata">

        <div class="help">
          Premi il bottone WhatsApp: il testo √® gi√† pronto (lo copiamo negli appunti).
        </div>

        <div class="actions">
          <a class="btn btn-wa" id="lbWA" href="#" rel="noopener nofollow">
            <img class="logo" src="../immagini-home/logo-whatsapp.png" alt="">
            Ordina questa foto su WhatsApp
          </a>
          <button class="btn btn-home" id="copyMsg">Copia il testo</button>
          <button class="btn btn-home" id="copyLink">Copia link foto</button>
          <a class="btn btn-home" id="openImg" href="#" target="_blank" rel="noopener nofollow">Apri foto ‚Üó</a>
        </div>

        <div class="noteBox" id="noteBox"></div>
      </div>
    </div>
  </div>

  <script>
    // CONFIG
    const WHATSAPP_TO = "https://wa.me/message/JDH7MM6C6VC7J1";
    const TOTAL = 62;
    const FILES = Array.from({length: TOTAL}, (_, i) => `fiori-${i+1}.jpg`);

    // Paginazione (boomer friendly: poche cose per volta)
    const PAGE_SIZE = window.matchMedia("(max-width: 920px)").matches ? 10 : 16;

    // Non caricare tutto insieme
    const MAX_CONCURRENT = 4;

    const grid = document.getElementById("grid");
    const loadMoreBtn = document.getElementById("loadMore");
    const statusEl = document.getElementById("status");

    async function copyToClipboard(text){
      try { await navigator.clipboard.writeText(text); } catch(e) {}
    }

    // CTA WhatsApp generico (copiamo un testo semplice)
    const genericText =
`Ciao! üëã
Vorrei ordinare dei fiori üå∏

Budget:
Colore/i:
Indirizzo:
Orario:`;

    function wireWA(id){
      const el = document.getElementById(id);
      if(!el) return;
      el.href = WHATSAPP_TO;
      el.addEventListener("click", async () => { await copyToClipboard(genericText); }, { once:true });
      el.title = "Apri WhatsApp (testo copiato negli appunti)";
    }
    wireWA("ctaWA");
    wireWA("fabWA");

    // Tile
    function makeTile(fileName){
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.dataset.file = fileName;

      const sk = document.createElement("div");
      sk.className = "skeleton";

      const img = document.createElement("img");
      img.alt = "Foto " + fileName;
      img.dataset.src = "./" + fileName; // immagini nella stessa cartella /fiori/
      img.decoding = "async";
      img.loading = "lazy";

      const cap = document.createElement("div");
      cap.className = "cap";
      cap.innerHTML = `<div>Foto</div><span>${fileName}</span>`;

      tile.appendChild(sk);
      tile.appendChild(img);
      tile.appendChild(cap);

      tile.addEventListener("click", () => openLightbox(fileName, img.dataset.src));
      return tile;
    }

    // Loader: queue + concurrency
    const queue = [];
    let active = 0;

    function enqueue(img){
      if(img.dataset.queued === "1" || img.dataset.loaded === "1") return;
      img.dataset.queued = "1";
      queue.push(img);
      pump();
    }

    function pump(){
      while(active < MAX_CONCURRENT && queue.length){
        const img = queue.shift();
        if(!img || img.dataset.loaded === "1") continue;
        active++;
        loadImg(img).finally(() => { active--; pump(); });
      }
    }

    function loadImg(img){
      return new Promise((resolve) => {
        const src = img.dataset.src;
        if(!src) return resolve();

        img.addEventListener("load", () => {
          img.dataset.loaded = "1";
          const tile = img.closest(".tile");
          tile?.classList.add("loaded");
          const sk = tile?.querySelector(".skeleton");
          if(sk) sk.style.display = "none";
          resolve();
        }, { once:true });

        img.addEventListener("error", () => {
          const tile = img.closest(".tile");
          const sk = tile?.querySelector(".skeleton");
          if(sk) sk.style.display = "none";
          img.style.opacity = "1";
          img.style.objectFit = "contain";
          img.style.background = "rgba(255,46,143,.06)";
          resolve();
        }, { once:true });

        img.src = src;
      });
    }

    // IO: carica quando serve
    let io = null;
    function ensureObserver(){
      if(io) return;
      io = new IntersectionObserver((entries) => {
        for(const e of entries){
          if(e.isIntersecting){
            const img = e.target.querySelector("img");
            if(img) enqueue(img);
            io.unobserve(e.target);
          }
        }
      }, { root:null, rootMargin:"700px 0px", threshold:0.01 });
    }

    function observeTiles(tiles){
      ensureObserver();
      tiles.forEach(t => io.observe(t));
    }

    // Pagination
    let rendered = 0;

    function updateStatus(){
      statusEl.textContent = `Mostrate ${rendered} di ${TOTAL}`;
      if(rendered >= TOTAL){
        loadMoreBtn.disabled = true;
        loadMoreBtn.textContent = "Fine ‚úÖ";
        loadMoreBtn.style.opacity = ".7";
      }
    }

    function renderNext(){
      const next = FILES.slice(rendered, rendered + PAGE_SIZE);
      const tiles = next.map(makeTile);
      tiles.forEach(t => grid.appendChild(t));
      observeTiles(tiles);
      rendered += next.length;
      updateStatus();
    }

    loadMoreBtn.addEventListener("click", renderNext);
    renderNext();

    // Lightbox (semplice)
    const lb = document.getElementById("lb");
    const lbBackdrop = document.getElementById("lbBackdrop");
    const lbClose = document.getElementById("lbClose");
    const lbTitle = document.getElementById("lbTitle");
    const lbImg = document.getElementById("lbImg");
    const lbWA = document.getElementById("lbWA");
    const copyMsgBtn = document.getElementById("copyMsg");
    const copyLinkBtn = document.getElementById("copyLink");
    const openImgBtn = document.getElementById("openImg");
    const noteBox = document.getElementById("noteBox");

    let currentMsg = "";
    let currentUrl = "";

    function absUrl(rel){
      try { return new URL(rel, window.location.href).href; } catch(e){ return rel; }
    }

    function buildMsg(fileName, photoUrl){
      return `Ciao! üëã
Mi piace questa foto dalla galleria Fiori:
${fileName}

Link foto:
${photoUrl}

Budget:
Colore/i:
Indirizzo:
Orario:`;
    }

    function openLightbox(fileName, relSrc){
      currentUrl = absUrl(relSrc || ("./" + fileName));
      currentMsg = buildMsg(fileName, currentUrl);

      lbTitle.textContent = "Foto: " + fileName;
      lbImg.src = currentUrl;
      openImgBtn.href = currentUrl;

      lbWA.href = WHATSAPP_TO;
      lbWA.onclick = async () => { await copyToClipboard(currentMsg); };

      noteBox.textContent = currentMsg;

      lb.classList.add("open");
      lb.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }

    function closeLightbox(){
      lb.classList.remove("open");
      lb.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
      lbImg.src = "";
    }

    lbBackdrop.addEventListener("click", closeLightbox);
    lbClose.addEventListener("click", closeLightbox);
    window.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeLightbox(); });

    copyMsgBtn.addEventListener("click", async ()=>{
      await copyToClipboard(currentMsg);
      copyMsgBtn.textContent = "Copiato ‚úÖ";
      setTimeout(()=> copyMsgBtn.textContent="Copia il testo", 1200);
    });

    copyLinkBtn.addEventListener("click", async ()=>{
      await copyToClipboard(currentUrl);
      copyLinkBtn.textContent = "Copiato ‚úÖ";
      setTimeout(()=> copyLinkBtn.textContent="Copia link foto", 1200);
    });
  </script>
</body>
</html>
